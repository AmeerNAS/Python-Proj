<!-- <form class="card" method="POST"> 
    {% for h in habits_weekly %}
        <input type="checkbox" class="h_check" name="{{ h.name }}" value=" {{ h.id }}">
        <label for="{{ h.name }}"><a href="/habit/{{ h.id }}"> {{h.name}} </a></label><br>
    {% endfor %}
</form> -->

<form class="card">
    {% for h in habits_weekly %}
        <input type="checkbox" class="h_check" id="habit_{{ h.id }}" 
               value="{{ h.id }}" 
               {% if h.isChecked() %}checked{% endif %}>
        <label for="habit_{{ h.id }}">
            <a href="/habit/{{ h.id }}"> {{ h.name }} </a>
        </label>
        <br>
    {% endfor %}
</form>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        document.querySelectorAll(".h_check").forEach(checkbox => {
            checkbox.addEventListener("change", function () {
                let habitId = this.value;
                let isChecked = this.checked;

                fetch(`/check/${habitId}`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ checked: isChecked })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        window.location.reload();
                    } else {
                        alert("Failed to update habit status.");
                    }
                    console.log("Updated:", data)
                })
                .catch(error => console.error("Error:", error));
            });
        });
    });
</script>
